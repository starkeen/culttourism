<h1>{$city.pc_title}</h1>
<div id="city_path">{$city.pc_pagepath}</div>
{if $city.pc_latitude && $city.pc_longitude}
<div id="mapcontainer"></div>
{/if}
<p>Условные обозначения:</p>
<ul id="legend_list" class="menu_common">
    {foreach from=$point_types item=ptype}
    <li><img src="/img/points/x16/{$ptype.tp_icon}"> {$ptype.tp_short}</li>
    {/foreach}
</ul>
<hr>
<p><a href="." id="page_point_link_back" title="перейти к достопримечательностям {$city.pc_inwheretext}">&larr; достопримечательности {$city.pc_inwheretext}</a></p>

<div style="height:25px;overflow:hidden;margin: 10px;">
    <script type="text/javascript" src="//yandex.st/share/share.js" charset="utf-8"></script>
    <div class="yashare-auto-init" data-yashareL10n="ru" data-yashareType="none" data-yashareQuickServices="yaru,vkontakte,facebook,twitter,odnoklassniki,moimir,lj,friendfeed,moikrug,gplus"></div> 
</div>

<script type="text/javascript">
    ymaps.ready(function() {
        var map = new ymaps.Map('mapcontainer', {
            center: [{$city.pc_longitude}, {$city.pc_latitude}],
            zoom: {$city.pc_zoom},
            behaviors: ['default', 'scrollZoom'],
            type: 'yandex#map'
        });
        var cluster = new ymaps.Clusterer({
            margin: [20],
            clusterIcons: [{
                    href: '/img/points/map/cluster.png',
                    size: [40, 40],
                    offset: [-20, -20]
                }],
            clusterNumbers: [100],
            gridSize: 50
        });
        map.controls.add("zoomControl").add("mapTools").add(new ymaps.control.TypeSelector(["yandex#map", "yandex#satellite", "yandex#hybrid"]));
        ymaps.geoXml.load("http://culttourism.ru/ajax/YMapsML/getcitymap/?cid={$city.pc_id}").then(function (res) {
            var arr = [];
            res.geoObjects.each(function (obj) {
                arr.push(obj);
            });
            cluster.add(arr);
            if (res.mapState) {
                res.mapState.applyToMap(map);
            }
        });
        map.geoObjects.add(cluster);
    });
</script>
<style>
    #mapcontainer {
        width:99%;
        min-height:400px;  
        height:600px;
        border:1px solid #99B099;
        margin:0 auto;
    }
    #legend_list li {
        display:block;
        float:left;
        height:20px;
        margin-right:20px;
        margin-bottom:20px;
        overflow:hidden;
        vertical-align: top;
    }
</style>