function showWindByURL(e,t){$(document).css("cursor","progress");$.get(e,t,function(e){$.modal(e,{overlayClose:true,opacity:80,width:600,height:200,overlayCss:{backgroundColor:"#ddd"}});console.log($("#object_container h2").position().top+$("#object_container h2").height());$("#object_text_container").css("bottom",$("#object_additional").height()).css("top",2.7*($("#object_container h2").position().top+$("#object_container h2").height()))});$(document).css("cursor","default")}function showMap(e,t,n,r){ymaps.ready(function(){var i=new ymaps.Map("objfinder_map",{center:[t,e],zoom:n,behaviors:["default","scrollZoom"],type:"yandex#publicMap"});i.controls.add("zoomControl").add("mapTools").add(new ymaps.control.TypeSelector(["yandex#map","yandex#hybrid","yandex#publicMap"]));if(r==-1){i.events.add("click",function(e){var t=e.get("coordPosition");$("#obj_lat").val(t[1]);$("#obj_lon").val(t[0]);$("#obj_zoom").val(i.getZoom());$("#city_lat").val(t[1]);$("#city_lon").val(t[0]);$("#city_zoom").val(i.getZoom())})}else if(r==0){var s=function(e){i.events.remove("click",s);var t=e.get("coordPosition");myPlacemark=new ymaps.Placemark(t,{hintContent:"Перетащите для изменения координат",balloonContent:$("#obj_name").text()},{iconImageHref:"/img/points/xmap/"+$("#obj_typeicon_h").val(),iconImageSize:[55,55],iconImageOffset:[-27,-55],draggable:true});$("#obj_lat").val(t[1]);$("#obj_lon").val(t[0]);$("#obj_zoom").val(i.getZoom());$("#city_lat").val(t[1]);$("#city_lon").val(t[0]);$("#city_zoom").val(i.getZoom());myPlacemark.events.add("dragend",function(){t=myPlacemark.geometry.getCoordinates();$("#obj_lat").val(t[1]);$("#obj_lon").val(t[0]);$("#obj_zoom").val(i.getZoom());$("#city_lat").val(t[1]);$("#city_lon").val(t[0]);$("#city_zoom").val(i.getZoom())});i.geoObjects.add(myPlacemark)};i.events.add("click",s)}else if(r==1){myPlacemark=new ymaps.Placemark([t,e],{hintContent:"Перетащите для изменения координат",balloonContent:$("#obj_name").text()},{iconImageHref:"/img/points/xmap/"+$("#obj_typeicon_h").val(),iconImageSize:[55,55],iconImageOffset:[-27,-55],draggable:true});myPlacemark.events.add("dragend",function(){coords=myPlacemark.geometry.getCoordinates();$("#obj_lat").val(coords[1]);$("#obj_lon").val(coords[0]);$("#obj_zoom").val(i.getZoom());$("#city_lat").val(coords[1]);$("#city_lon").val(coords[0]);$("#city_zoom").val(i.getZoom())});i.geoObjects.add(myPlacemark)}$(".dogo").live("click",function(){var e=[parseFloat($("#obj_lon").val()),parseFloat($("#obj_lat").val())];i.panTo(e,{flying:true,delay:0,duration:1e3});myPlacemark.geometry.setCoordinates(e);return false});$("#obj_addr_searcher").live("click",function(){ymaps.geocode($("#obj_addr_searcher").text(),{kind:"house",boundedBy:i.getBounds(),results:20}).then(function(e){i.geoObjects.add(e.geoObjects);e.geoObjects.each(function(e){i.panTo(e.geometry._n,{flying:true,delay:0,duration:1e3})})})})})}$(document).ready(function(){$("#show_auth_form").click(function(){showWindByURL("/ajax/forms/commonlogin/",{});return false});$(".obj_best").append('<img class="obj_best_pic" src="/img/points/best-24.png" />');$(".objlink").live("click",function(){showWindByURL("/ajax/point/",{id:this.href.split("/").pop().slice(6,-5)});return false});$(".city_weather").each(function(){var e=this;$.get("/ajax/weather/getbycoords/",{lat:$(e).data("lat"),lon:$(e).data("lon")},function(t){var n=$.parseJSON(t);if(n.state){$(e).html(n.content).removeAttr("title")}else{$(e).html("загрузить погоду не удалось")}})});$(".hiddenedit").live("click",function(){$(this).addClass("hiddenedit_active");this.id=="pc_title_edit"&&$("div#pc_title_handler input").show();this.id=="pc_text_edit"&&$("div#pc_text_handler input").show();if(this.id=="pc_text_hidd"){$(document).css("cursor","progress");$("#pc_text_edit").ckeditor(function(){},{customConfig:"/config/config.cke.js",toolbar:"City"});$("#pc_text_edit").css("height","500px").val($(this).html());$(this).hide();$("#pc_text_handler input").show();$("#map_container").hide();$("#city_float").hide();$(document).css("cursor","default")}if(this.id=="pt_name_hidd"){$(this).hide();$("#pt_name_edit").show().focus().addClass("hiddenedit_active").val($(this).html());$("div#pt_name_handler input").show()}if(this.id=="pt_description_hidd"){$(document).css("cursor","progress");$("#pt_description_edit").css("height","300px").css("width","100%").val($(this).html()).ckeditor(function(){},{customConfig:"/config/config.cke.js"});$(this).hide();$("#pt_description_edit").show().focus().css("height","0");$("div#pt_description_handler input").show();$(document).css("cursor","default")}});$(".formhandler input.dosave").live("click",function(){if($(this).parent().attr("id")=="pc_title_handler"){$(document).css("cursor","progress");$("#pc_title_handler input").hide();$.post("/ajax/city/savetitle/?id="+$("#pc_id").val(),{id:$("#pc_id").val(),ntitle:$("#pc_title_edit").val()},function(e){$("div#pc_title_handler input").hide();$("#pc_title_edit").removeClass("hiddenedit_active").val(e)});$(document).css("cursor","default")}if($(this).parent().attr("id")=="pc_text_handler"){$(document).css("cursor","progress");$("#pc_text_handler input").hide();$.post("/ajax/city/savedescr/?id="+$("#pc_id").val(),{id:$("#pc_id").val(),ntext:$("#pc_text_edit").val()},function(e){$("#pc_text_edit").ckeditor(function(){this.destroy()});$("#pc_text_edit").css("height","0").removeClass("hiddenedit_active").hide();$("#pc_text_hidd").html(e).show().removeClass("hiddenedit_active");$("#map_container").show();$("#city_float").show()});$(document).css("cursor","default")}if($(this).parent().attr("id")=="pt_name_handler"){$(document).css("cursor","progress");$("#pt_name_handler input").hide();$.post("/ajax/point/savetitle/?id="+$("#pt_id").val(),{id:$("#pt_id").val(),nname:$("#pt_name_edit").val()},function(e){$("div#pt_name_handler input").hide();$("#pt_name_edit").removeClass("hiddenedit_active").hide();$("#pt_name_hidd").text(e).show().removeClass("hiddenedit_active");$("#object_id_"+$("#pt_id").val()).text(e)});$(document).css("cursor","default")}if($(this).parent().attr("id")=="pt_description_handler"){$("div#pt_description_handler input").hide();$(document).css("cursor","progress");$.post("/ajax/point/savedescr/?id="+$("#pt_id").val(),{id:$("#pt_id").val(),ndesc:$("#pt_description_edit").val()},function(e){$("#pt_description_edit").ckeditor(function(){this.destroy()});$("#pt_description_edit").css("height","0").removeClass("hiddenedit_active").hide();$("#pt_description_hidd").html(e).show().removeClass("hiddenedit_active")});$(document).css("cursor","default")}if($(this).parent().attr("id")=="pt_add_handler"){$(document).css("cursor","progress");$("#pt_add_handler input").hide();$("div#pt_add_handler").html("").text("сохраняется...");$.post("/ajax/point/savenew/?cid="+$("#pc_id").val(),{cid:$("#pc_id").attr("readonly",true).val(),nname:$("#pt_name_add").attr("readonly",true).val(),ndesc:$("#pt_description_add").attr("readonly",true).val(),nweb:$("#pt_web_add").attr("readonly",true).val(),nmail:$("#pt_email_add").attr("readonly",true).val(),nphone:$("#pt_phone_add").attr("readonly",true).val(),nwork:$("#pt_worktime_add").attr("readonly",true).val(),naddr:$("#pt_addr_add").attr("readonly",true).val(),nlat:$("#pt_lat").attr("readonly",true).val(),nlon:$("#pt_lon").attr("readonly",true).val(),nbest:$("#pt_is_best_add").attr("readonly",true).attr("checked")},function(e){$("#pt_description_add").ckeditor(function(){this.destroy()});var t="";if($("#pt_lat").val()>0&&$("#pt_lon").val()>0)t="N"+$("#pt_lat").val()+" E"+$("#pt_lon").val();else t="указать";$("#whatseelist").append('<tr><td><img class="point_typer" id="type_'+e+'" src="/img/points/x32/star.png" alt="другое" /></td><td><a href="object'+e+'.html" id="object_id_'+e+'" class="objlink" title="подробно: '+$("#pt_name_add").val()+'">'+$("#pt_name_add").val()+'</a></td><td><a href="#" id="gps_'+e+'" class="point_latlon">'+t+'</a></td><td><img class="point_deleter" id="del_'+e+'" src="/img/btn/ico.delete.gif" /></td></tr>');$.modal.close()});$(document).css("cursor","default")}if($(this).parent().attr("id")=="pt_contacts_handler"){$(document).css("cursor","progress");$("#pt_contacts_handler input").hide();$("#pt_cont_adress").text($("#pt_cont_adress_edit").val());$("#pt_cont_worktime").text($("#pt_cont_worktime_edit").val());$("#pt_cont_phone").text($("#pt_cont_phone_edit").val());$("#pt_cont_website").text($("#pt_cont_website_edit").val()).attr("href",$("#pt_cont_website_edit").val());$("#pt_cont_email").text($("#pt_cont_email_edit").val()).attr("href","mailto:"+$("#pt_cont_email_edit").val());$.post("/ajax/point/savecontacts/?cid="+$("#pt_id").val(),{cid:$("#pt_id").val(),nwebsite:$("#pt_cont_website").attr("readonly",true).text(),nemail:$("#pt_cont_email").attr("readonly",true).text(),nphone:$("#pt_cont_phone").attr("readonly",true).text(),nworktime:$("#pt_cont_worktime").attr("readonly",true).text(),nadress:$("#pt_cont_adress").attr("readonly",true).text()},function(e){if(e){$(".edit_cont").show();$("div#pt_contacts_handler input").hide();$(".hiddenedit_cont").hide();$("#do_cont_edit").show()}});$(document).css("cursor","default")}if($(this).parent().attr("id")=="br_save_handler"){$.post("/ajax/blog/saveform/?bid="+$("#pr_id").val(),{brid:$("#br_id").val(),ntitle:$("#eblog_title").val(),ntext:$("#eblog_text").val(),ndate:$("#eblog_date").val(),ntime:$("#eblog_time").val(),nact:$("#eblog_active").attr("checked")=="checked",nurl:$("#eblog_url").val()},function(e){if(e){$("#eblog_text").ckeditor(function(){this.destroy()});$.modal.close();document.location="/blog/"}})}});$(".formhandler input.doesc").live("click",function(){if($(this).parent().attr("id")=="pc_title_handler"){$("#pc_title_edit").val($("#pc_title_hidd").val()).removeClass("hiddenedit_active");$("div#pc_title_handler input").hide()}if($(this).parent().attr("id")=="pc_text_handler"){$("#pc_text_edit").ckeditor(function(){this.destroy()});$("#pc_text_edit").css("height","0").hide();$("#pc_text_hidd").show().removeClass("hiddenedit_active");$("div#pc_text_handler input").hide();$("#map_container").show();$("#city_float").show()}if($(this).parent().attr("id")=="pt_name_handler"){$("#pt_name_edit").hide().removeClass("hiddenedit_active");$("#pt_name_hidd").show().removeClass("hiddenedit_active");$("div#pt_name_handler input").hide()}if($(this).parent().attr("id")=="pt_description_handler"){$("#pt_description_edit").ckeditor(function(){this.destroy()});$("#pt_description_edit").hide().removeClass("hiddenedit_active");$("#pt_description_hidd").show().removeClass("hiddenedit_active");$("#pt_description_handler input").hide()}if($(this).parent().attr("id")=="pt_add_handler"){$("#pt_description_add").ckeditor(function(){this.destroy()});$("#pt_description_add").live("mouseover",function(){$("#pt_description_add").die("mouseover").ckeditor(function(){},{customConfig:"/config/config.cke.js"})});$.modal.close()}if($(this).parent().attr("id")=="pt_contacts_handler"){$(".edit_cont").show();$("div#pt_contacts_handler input").hide();$(".hiddenedit_cont").hide();$("#do_cont_edit").show()}if($(this).parent().attr("id")=="br_save_handler"){$("#eblog_text").ckeditor(function(){this.destroy()});$.modal.close()}});$("#pt_is_best_edit").live("change",function(){$.post("/ajax/point/savebest/?id="+$("#pt_id").val(),{id:$("#pt_id").val(),nstate:$(this).attr("checked")})});$("#do_cont_edit").live("click",function(){$("#pt_cont_adress_edit").val($("#pt_cont_adress").text());$("#pt_cont_worktime_edit").val($("#pt_cont_worktime").text());$("#pt_cont_phone_edit").val($("#pt_cont_phone").text());$("#pt_cont_website_edit").val($("#pt_cont_website").text());$("#pt_cont_email_edit").val($("#pt_cont_email").text());$("div#pt_contacts_handler input").show();$(this).hide();$(".edit_cont").hide();$(".hiddenedit_cont").show()});$("#do_add_point").click(function(){$(document).css("cursor","progress");showWindByURL("/ajax/point/getnewform/",{cid:$("#pc_id").val()});$("#pt_description_add").live("mouseover",function(){$("#pt_description_add").die("mouseover");$("#pt_description_add").ckeditor(function(){},{customConfig:"/config/config.cke.js"})});$(document).css("cursor","default");return false});$(".point_deleter").live("click",function(){var e=this.id.split("_"),t=$(this).parents("tr");confirm("Действительно удалить точку?")&&$.post("/ajax/point/delpoint/?pid="+e[1],{pid:e[1]},function(e){e&&$(t).remove()})});$(".point_typer").live("click",function(){showWindByURL("/ajax/pointtype/getform/",{pid:this.id.split("_")[1]})});$("#type_selector tr").live("click",function(){var e=this.id.split("_"),t=$("#pt_id").val();$.post("/ajax/pointtype/savetype/?pid="+$("#pt_id").val(),{pid:t,ntype:e[1]},function(e){$("img#type_"+t+".point_typer").attr("src","/img/points/x32/"+e);$.modal.close()})});$("a.check_all").click(function(){$("input.export_check").attr("checked","true");return false});$("a.check_not").click(function(){$("input.export_check").removeAttr("checked");return false});$("a.export_about").click(function(){showWindByURL("/ajax/page/gps/",{});return false});$("#captchahelp").click(function(){stamp=new Date;$("#norobotpic").attr("src","/feedback/getcapt/"+stamp.getTime());return false});$(".point_latlon").live("click",function(){showWindByURL("/ajax/point/getformGPS/",{pid:this.id.split("_")[1]});return false});$("#pt_latlon_handler input.dosave").live("click",function(){$.post("/ajax/point/saveformGPS/?pid="+$("#obj_id").val(),{pt_lat:$("#obj_lat").val(),pt_lon:$("#obj_lon").val(),pt_zoom:$("#obj_zoom").val()},function(e){if(e){$("#gps_"+$("#obj_id").val()).text(e);$.modal.close()}})});$("#pt_latlon_handler input.doesc").live("click",function(){$.modal.close()});$("#citymap_finder").click(function(){showWindByURL("/ajax/city/getformGPS/",{cid:document.location.search.split("city_id=")[1]});return false});$("#pc_latlon_handler input.dosave").live("click",function(){$.post("/ajax/city/saveformGPS/?cid="+$("#city_id").val(),{pc_lat:$("#city_lat").val(),pc_lon:$("#city_lon").val(),pc_zoom:$("#city_zoom").val()},function(e){if(e){$("#pc_latitude").val($("#city_lat").val());$("#pc_longitude").val($("#city_lon").val());$.modal.close()}})});$("#pc_latlon_handler input.doesc").live("click",function(){$.modal.close()});$("a.typefilterlink").live("click",function(){var e=this.href.split("#")[1].split("_")[1];$("a.points_selector_active").removeClass("points_selector_active").addClass("points_selector_inactive");$(this).removeClass("points_selector_inactive").addClass("points_selector_active");$(".points_selector_active").each(function(){$(this).children("img").attr("src",$(this).children("img").attr("src").replace("x32","i32"))});$(".points_selector_inactive").each(function(){$(this).children("img").attr("src",$(this).children("img").attr("src").replace("i32","x32"))});if($(this).parent("li").parent("ul").attr("id")=="menu_type2"){if(e!="all"){$("#whatservlist tr").hide();$("#whatservlist tr.obj_type_"+e).show()}else $("#whatservlist tr").show()}if($(this).parent("li").parent("ul").attr("id")=="menu_type1"){if(e!="all"){$("#whatseelist tr").hide();$("#whatseelist tr.obj_type_"+e).show()}else $("#whatseelist tr").show()}return false});$(".blog_entry_edit").live("click",function(){var e=this.id.split("_");showWindByURL("/ajax/blog/editform/",{brid:e[2]});$("#eblog_text").live("mouseover",function(){$("#eblog_text").die("mouseover").ckeditor(function(){},{customConfig:"/config/config.cke.js"});$("#eblog_date").datepicker({dateFormat:"dd.mm.yy"})});$("#eblog_date").live("click",function(){$(this).datepicker({dateFormat:"dd.mm.yy"})});return false});$("#blog_entry_add").live("click",function(){showWindByURL("/ajax/blog/addform/",null);$("#eblog_text").live("mouseover",function(){$("#eblog_text").die("mouseover").ckeditor(function(){},{customConfig:"/config/config.cke.js"});$("#eblog_date").datepicker({dateFormat:"dd.mm.yy"})});$("#eblog_date").live("click",function(){$(this).datepicker({dateFormat:"dd.mm.yy"})});return false});$(".blog_entry_delete").live("click",function(){var e=this.id.split("_");confirm('Действительно удалить запись "'+$(this).parent("h2").children("a").text()+'"?')&&$.post("/ajax/blog/delentry/?bid="+e[2],{brid:e[2]},function(e){if(e)document.location="/blog/"});return false});if($("#city_keywds").val())$("#city_sign_keywds").text($("#city_keywds").val().length);$("#city_sign_descr").text($("#city_descr").text().length);$(document).on("keyup","#city_keywds",function(){$("#city_sign_keywds").text($("#city_keywds").val().length)});$(document).on("keyup","#city_descr",function(){$("#city_sign_descr").text($("#city_descr").val().length)});$(".button_active").click(function(){switch($(this).data("act")){case"add":if($("#city_meta_add_value").val()!==""){$.post("/city/meta/",{act:$(this).data("act"),cf:$("#city_meta_add_cf").val(),val:$("#city_meta_add_value").val(),cpid:$("#city_meta_pcid").val()},function(e){if(e!==""){$("#city_meta_add_value").val("");$("#city_meta_add_cf :selected").remove()}})}break;case"del":var e=$(this).data("cfid");$.post("/city/meta/",{act:$(this).data("act"),cf:e,cpid:$("#city_meta_pcid").val()},function(t){if(t==="ok"){$("#city_meta_row_"+e).hide()}});break;case"edit":var e=$(this).data("cfid");$.post("/city/meta/",{act:$(this).data("act"),cf:e,val:$("#city_meta_value_"+e).val(),cpid:$("#city_meta_pcid").val()});break}});$("#searchform_input").autocomplete({serviceUrl:"/search/suggest/",paramName:"query",onSelect:function(e){document.location.href=e.url}});$("#search_mainform_q").autocomplete({serviceUrl:"/search/suggest/",paramName:"query",onSelect:function(e){document.location.href=e.url}})})