$(document).ready(function(){var b="http://"+window.location.host+"/";$("#loginform").load(b+"ajax/forms/commonlogin/");$("#logintoggler").toggle(function(){$("#logintoggler").animate({top:"28px"});$("#loginform").animate({height:"24px"});this.src=b+"img/btn/btn.grip.png"},function(){$("#logintoggler").animate({top:"3px"});$("#loginform").animate({height:"0px"});this.src=b+"img/btn/btn.expand.png"});$(".objlink").live("click",function(){var a={id:this.href.split("/").pop().slice(6,-5)};showWindByURL(b+
"ajax/point/",a);return false});$(".hiddenedit").live("click",function(){$(this).addClass("hiddenedit_active");this.id=="pc_title_edit"&&$("div#pc_title_handler input").show();this.id=="pc_text_edit"&&$("div#pc_text_handler input").show();if(this.id=="pc_text_hidd"){$(document).css("cursor","progress");$("#pc_text_edit").ckeditor(function(){},{customConfig:"../../../../config/config.cke.js",toolbar:"City"});$("#pc_text_edit").css("height","500px");$("#pc_text_edit").val($(this).html());$(this).hide();
$("#pc_text_handler input").show();$("#map_container").hide();$(document).css("cursor","default")}if(this.id=="pt_name_hidd"){$(this).hide();$("#pt_name_edit").show().focus().addClass("hiddenedit_active").val($(this).html());$("div#pt_name_handler input").show()}if(this.id=="pt_description_hidd"){$(document).css("cursor","progress");$("#pt_description_edit").css("height","300px");$("#pt_description_edit").css("width","100%");$("#pt_description_edit").val($(this).html());$("#pt_description_edit").ckeditor(function(){},
{customConfig:"../../../../config/config.cke.js"});$(this).hide();$("#pt_description_edit").show().focus();$("#pt_description_edit").css("height","0");$("div#pt_description_handler input").show();$(document).css("cursor","default")}});$(".formhandler input.dosave").live("click",function(){if($(this).parent().attr("id")=="pc_title_handler"){$(document).css("cursor","progress");$("#pc_title_handler input").hide();$.post(b+"ajax/city/savetitle/?id="+$("#pc_id").val(),{id:$("#pc_id").val(),ntitle:$("#pc_title_edit").val()},
function(a){$("div#pc_title_handler input").hide();$("#pc_title_edit").removeClass("hiddenedit_active");$("#pc_title_edit").val(a)});$(document).css("cursor","default")}if($(this).parent().attr("id")=="pc_text_handler"){$(document).css("cursor","progress");$("#pc_text_handler input").hide();$.post(b+"ajax/city/savedescr/?id="+$("#pc_id").val(),{id:$("#pc_id").val(),ntext:$("#pc_text_edit").val()},function(a){$("#pc_text_edit").ckeditor(function(){this.destroy()});$("#pc_text_edit").css("height","0");
$("#pc_text_edit").removeClass("hiddenedit_active").hide();$("#pc_text_hidd").html(a).show().removeClass("hiddenedit_active");$("#map_container").show()});$(document).css("cursor","default")}if($(this).parent().attr("id")=="pt_name_handler"){$(document).css("cursor","progress");$("#pt_name_handler input").hide();$.post(b+"ajax/point/savetitle/?id="+$("#pt_id").val(),{id:$("#pt_id").val(),nname:$("#pt_name_edit").val()},function(a){$("div#pt_name_handler input").hide();$("#pt_name_edit").removeClass("hiddenedit_active").hide();
$("#pt_name_hidd").text(a);$("#pt_name_hidd").show().removeClass("hiddenedit_active");$("#object_id_"+$("#pt_id").val()).text(a)});$(document).css("cursor","default")}if($(this).parent().attr("id")=="pt_description_handler"){$("div#pt_description_handler input").hide();$(document).css("cursor","progress");$.post(b+"ajax/point/savedescr/?id="+$("#pt_id").val(),{id:$("#pt_id").val(),ndesc:$("#pt_description_edit").val()},function(a){$("#pt_description_edit").ckeditor(function(){this.destroy()});$("#pt_description_edit").css("height",
"0");$("#pt_description_edit").removeClass("hiddenedit_active").hide();$("#pt_description_hidd").html(a).show().removeClass("hiddenedit_active")});$(document).css("cursor","default")}if($(this).parent().attr("id")=="pt_add_handler"){$(document).css("cursor","progress");$("div#pt_add_handler input").hide();$.post(b+"ajax/point/savenew/?cid="+$("#pc_id").val(),{cid:$("#pc_id").val(),nname:$("#pt_name_add").val(),ndesc:$("#pt_description_add").val(),nweb:$("#pt_web_add").val(),nmail:$("#pt_email_add").val(),
nphone:$("#pt_phone_add").val(),nwork:$("#pt_worktime_add").val(),naddr:$("#pt_addr_add").val()},function(a){$("#pt_description_add").ckeditor(function(){this.destroy()});$("#whatseelist").append('<tr><td><img class="point_typer" id="type_'+a+'" src="../../../img/points/32/star.png" alt="\u0434\u0440\u0443\u0433\u043e\u0435" /></td><td><a href="object'+a+'.html" id="object_id_'+a+'" class="objlink" title="\u043f\u043e\u0434\u0440\u043e\u0431\u043d\u043e: '+$("#pt_name_add").val()+'">'+$("#pt_name_add").val()+
'</a></td><td><a href="#" id="gps_'+a+'" class="point_latlon">\u0443\u043a\u0430\u0437\u0430\u0442\u044c</a></td><td><img class="point_deleter" id="del_'+a+'" src="../../../img/btn/ico.delete.gif" /></td></tr>');$.modal.close()});$(document).css("cursor","default")}if($(this).parent().attr("id")=="pt_contacts_handler"){$(document).css("cursor","progress");$("#pt_contacts_handler input").hide();$("#pt_cont_adress").text($("#pt_cont_adress_edit").val());$("#pt_cont_worktime").text($("#pt_cont_worktime_edit").val());
$("#pt_cont_phone").text($("#pt_cont_phone_edit").val());$("#pt_cont_website").text($("#pt_cont_website_edit").val());$("#pt_cont_website").attr("href",$("#pt_cont_website_edit").val());$("#pt_cont_email").text($("#pt_cont_email_edit").val());$("#pt_cont_email").attr("href","mailto:"+$("#pt_cont_email_edit").val());$.post(b+"ajax/point/savecontacts/?cid="+$("#pt_id").val(),{cid:$("#pt_id").val(),nwebsite:$("#pt_cont_website").text(),nemail:$("#pt_cont_email").text(),nphone:$("#pt_cont_phone").text(),
nworktime:$("#pt_cont_worktime").text(),nadress:$("#pt_cont_adress").text()},function(a){if(a){$(".edit_cont").show();$("div#pt_contacts_handler input").hide();$(".hiddenedit_cont").hide();$("#do_cont_edit").show()}});$(document).css("cursor","default")}$(this).parent().attr("id")=="br_save_handler"&&$.post(b+"ajax/blog/saveform/?bid="+$("#pr_id").val(),{brid:$("#br_id").val(),ntitle:$("#eblog_title").val(),ntext:$("#eblog_text").val(),ndate:$("#eblog_date").val(),ntime:$("#eblog_time").val(),nact:$("#eblog_active").attr("checked"),
nurl:$("#eblog_url").val()},function(a){if(a){$("#eblog_text").ckeditor(function(){this.destroy()});$.modal.close();document.location="../../blog/"}})});$(".formhandler input.doesc").live("click",function(){if($(this).parent().attr("id")=="pc_title_handler"){$("#pc_title_edit").val($("#pc_title_hidd").val()).removeClass("hiddenedit_active");$("div#pc_title_handler input").hide()}if($(this).parent().attr("id")=="pc_text_handler"){$("#pc_text_edit").ckeditor(function(){this.destroy()});$("#pc_text_edit").css("height",
"0");$("#pc_text_edit").hide();$("#pc_text_hidd").show().removeClass("hiddenedit_active");$("div#pc_text_handler input").hide();$("#map_container").show()}if($(this).parent().attr("id")=="pt_name_handler"){$("#pt_name_edit").hide().removeClass("hiddenedit_active");$("#pt_name_hidd").show().removeClass("hiddenedit_active");$("div#pt_name_handler input").hide()}if($(this).parent().attr("id")=="pt_description_handler"){$("#pt_description_edit").ckeditor(function(){this.destroy()});$("#pt_description_edit").hide().removeClass("hiddenedit_active");
$("#pt_description_hidd").show().removeClass("hiddenedit_active");$("#pt_description_handler input").hide()}if($(this).parent().attr("id")=="pt_add_handler"){$("#pt_description_add").ckeditor(function(){this.destroy()});$("#pt_description_add").live("mouseover",function(){$("#pt_description_add").die("mouseover");$("#pt_description_add").ckeditor(function(){},{customConfig:"../../../../config/config.cke.js"})});$.modal.close()}if($(this).parent().attr("id")=="pt_contacts_handler"){$(".edit_cont").show();
$("div#pt_contacts_handler input").hide();$(".hiddenedit_cont").hide();$("#do_cont_edit").show()}if($(this).parent().attr("id")=="br_save_handler"){$("#eblog_text").ckeditor(function(){this.destroy()});$.modal.close()}});$("#do_cont_edit").live("click",function(){$("#pt_cont_adress_edit").val($("#pt_cont_adress").text());$("#pt_cont_worktime_edit").val($("#pt_cont_worktime").text());$("#pt_cont_phone_edit").val($("#pt_cont_phone").text());$("#pt_cont_website_edit").val($("#pt_cont_website").text());
$("#pt_cont_email_edit").val($("#pt_cont_email").text());$("div#pt_contacts_handler input").show();$(this).hide();$(".edit_cont").hide();$(".hiddenedit_cont").show()});$("#do_add_point").click(function(){$(document).css("cursor","progress");var a={cid:$("#pc_id").val()};showWindByURL(b+"ajax/point/getnewform/",a);$("#pt_description_add").live("mouseover",function(){$("#pt_description_add").die("mouseover");$("#pt_description_add").ckeditor(function(){},{customConfig:"../../../../config/config.cke.js"})});
$(document).css("cursor","default");return false});$(".point_deleter").live("click",function(){var a=this.id.split("_"),g=$(this).parents("tr");confirm("\u0414\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0442\u043e\u0447\u043a\u0443?")&&$.post(b+"ajax/point/delpoint/?pid="+a[1],{pid:a[1]},function(i){i&&$(g).remove()})});$(".point_typer").live("click",function(){var a={pid:this.id.split("_")[1]};showWindByURL(b+"ajax/pointtype/getform/",
a)});$("#type_selector tr").live("click",function(){var a=this.id.split("_"),g=$("#pt_id").val();$.post(b+"ajax/pointtype/savetype/?pid="+$("#pt_id").val(),{pid:g,ntype:a[1]},function(i){$("img#type_"+g+".point_typer").attr("src","../../../img/points/32/"+i);$.modal.close()})});$("#captchahelp").click(function(){stamp=new Date;$("#norobotpic").attr("src","../../../feedback/getcapt/"+stamp.getTime());return false});$(".point_latlon").live("click",function(){var a={pid:this.id.split("_")[1]};showWindByURL(b+
"ajax/point/getformGPS/",a);return false});$("#pt_latlon_handler input.dosave").live("click",function(){$.post(b+"ajax/point/saveformGPS/?pid="+$("#obj_id").val(),{pt_lat:$("#obj_lat").val(),pt_lon:$("#obj_lon").val(),pt_zoom:$("#obj_zoom").val()},function(a){if(a){$("#gps_"+$("#obj_id").val()).text(a);$.modal.close()}})});$("#pt_latlon_handler input.doesc").live("click",function(){$.modal.close()});$("#citymap_finder").click(function(){var a={cid:document.location.search.split("city_id=")[1]};showWindByURL(b+
"ajax/city/getformGPS/",a);return false});$("#pc_latlon_handler input.dosave").live("click",function(){$.post(b+"ajax/city/saveformGPS/?cid="+$("#city_id").val(),{pc_lat:$("#city_lat").val(),pc_lon:$("#city_lon").val(),pc_zoom:$("#city_zoom").val()},function(a){if(a){$("#pc_latitude").val($("#city_lat").val());$("#pc_longitude").val($("#city_lon").val());$.modal.close()}})});$("#pc_latlon_handler input.doesc").live("click",function(){$.modal.close()});$("a.typefilterlink").live("click",function(){var a=
this.href.split("#")[1].split("_")[1];if(a!="all"){$("#whatseelist tr").hide();$("#whatseelist tr.obj_type_"+a).show()}else $("#whatseelist tr").show();return false});$(".blog_entry_edit").live("click",function(){var a=this.id.split("_");showWindByURL(b+"ajax/blog/editform/",{brid:a[2]});$("#eblog_text").live("mouseover",function(){$("#eblog_text").die("mouseover");$("#eblog_text").ckeditor(function(){},{customConfig:"../../../../config/config.cke.js"});$("#eblog_date").datepicker({dateFormat:"dd.mm.yy"})});
$("#eblog_date").live("click",function(){$(this).datepicker({dateFormat:"dd.mm.yy"})});return false});$("#blog_entry_add").live("click",function(){showWindByURL(b+"ajax/blog/addform/",null);$("#eblog_text").live("mouseover",function(){$("#eblog_text").die("mouseover");$("#eblog_text").ckeditor(function(){},{customConfig:"../../../../config/config.cke.js"});$("#eblog_date").datepicker({dateFormat:"dd.mm.yy"})});$("#eblog_date").live("click",function(){$(this).datepicker({dateFormat:"dd.mm.yy"})});
return false});$(".blog_entry_delete").live("click",function(){var a=this.id.split("_");confirm('\u0414\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0437\u0430\u043f\u0438\u0441\u044c "'+$(this).parent("h2").children("a").text()+'"?')&&$.post(b+"ajax/blog/delentry/?bid="+a[2],{brid:a[2]},function(g){if(g)document.location="../../blog/"});return false})});
function showWindByURL(b,a){$(document).css("cursor","progress");$.get(b,a,function(g){$.modal(g,{overlayClose:true,opacity:80,width:600,height:200,overlayCss:{backgroundColor:"#ddd"}})});$(document).css("cursor","default")}
function showMap(b,a,g,i){$(document).css("cursor","progress");var f=new YMaps.Map(YMaps.jQuery("#objfinder_map")[0]);f.setCenter(new YMaps.GeoPoint(a,b),g);f.addControl(new YMaps.TypeControl([YMaps.MapType.MAP,YMaps.MapType.HYBRID],[1,1]));f.addControl(new YMaps.Zoom);f.addControl(new YMaps.ScaleLine);f.enableScrollZoom();if(i==1){var j=new YMaps.Placemark(new YMaps.GeoPoint(a,b),{draggable:true});f.addOverlay(j);YMaps.Events.observe(j,j.Events.Drag,function(c){c.setIconContent($("#obj_name").text())});
YMaps.Events.observe(j,j.Events.DragEnd,function(c){j.name=$("#obj_name").text();j.openBalloon();c.setIconContent(null);c.update();c=c.getGeoPoint();$("#obj_lat").val(c.getLat());$("#obj_lon").val(c.getLng());$("#obj_zoom").val(f.getZoom());$("#city_lat").val(c.getLat());$("#city_lon").val(c.getLng());$("#city_zoom").val(f.getZoom())})}if(i==0)var l=YMaps.Events.observe(f,f.Events.Click,function(c,k){var e=new YMaps.Placemark(k.getGeoPoint(),{draggable:true});c.addOverlay(e);l.cleanup();var h=k.getGeoPoint();
$("#obj_lat").val(h.getLat());$("#obj_lon").val(h.getLng());$("#city_lat").val(h.getLat());$("#city_lon").val(h.getLng());YMaps.Events.observe(e,e.Events.Drag,function(d){$("#obj_name").text()!=""&&d.setIconContent($("#obj_name").text());$("#city_name").text()!=""&&d.setIconContent($("#city_name").text())});YMaps.Events.observe(e,e.Events.DragEnd,function(d){if($("#obj_name").text()!="")e.name=$("#obj_name").text();if($("#city_name").text()!="")e.name=$("#city_name").text();e.openBalloon();d.setIconContent(null);
d.update();d=d.getGeoPoint();$("#obj_lat").val(d.getLat());$("#obj_lon").val(d.getLng());$("#obj_zoom").val(c.getZoom());$("#city_lat").val(d.getLat());$("#city_lon").val(d.getLng());$("#city_zoom").val(c.getZoom())})},this);if(i==-1){f.addControl(new YMaps.SearchControl);l=YMaps.Events.observe(f,f.Events.Click,function(c,k){var e=new YMaps.Placemark(k.getGeoPoint(),{draggable:true}),h=k.getGeoPoint();$("#obj_lat").val(h.getLat());$("#obj_lon").val(h.getLng());$("#obj_zoom").val(c.getZoom());$("#city_lat").val(h.getLat());
$("#city_lon").val(h.getLng());$("#city_zoom").val(c.getZoom());c.addOverlay(e);l.cleanup();YMaps.Events.observe(e,e.Events.DragEnd,function(d){if($("#obj_name").text()!="")e.name=$("#obj_name").text();if($("#city_name").text()!="")e.name=$("#city_name").text();e.openBalloon();d.setIconContent(null);d.update();d=d.getGeoPoint();$("#obj_lat").val(d.getLat());$("#obj_lon").val(d.getLng());$("#obj_zoom").val(c.getZoom());$("#city_lat").val(d.getLat());$("#city_lon").val(d.getLng());$("#city_zoom").val(c.getZoom())})},
this)}$(document).css("cursor","default")};
